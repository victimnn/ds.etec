<!DOCTYPE html><html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Capybara Konga</title>
  <meta name="description" content="Uma vers√£o capivara e 100% SFW do matias.me/nsfw ‚Äî capivaras dan√ßando ao ritmo gerado no pr√≥prio navegador." />
  <style>
    :root {
      --bg: #0b1020;
      --fg: #ffe9b5;
      --accent: #ff7a59;
      --accent-2: #6ee7ff;
      --btn-bg: #ff4d6d;
      --btn-fg: #1b0b14;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 50% 50%, #111628, #090f1c 40%, #050812 80%);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      overflow: hidden;
    }/* Entrada */
.gate {
  position: absolute; inset: 0;
  display: grid; place-items: center;
  background: conic-gradient(from 0deg, #0b1020, #0e1530, #0b1020);
  animation: hue 12s linear infinite;
}
@keyframes hue { to { filter: hue-rotate(360deg); } }

.start {
  display: grid; gap: 18px; place-items: center;
  text-align: center; padding: 32px 28px;
  border-radius: 28px; backdrop-filter: blur(8px);
  background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 20px 60px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.06);
}
.title { font-size: clamp(28px, 5vw, 44px); letter-spacing: 1px; font-weight: 800; }
.tag { opacity: .75; font-size: 14px; }

.btn {
  appearance: none; border: 0; cursor: pointer; user-select: none;
  padding: 14px 22px; border-radius: 999px; font-weight: 800; font-size: 18px;
  background: linear-gradient(180deg, #ffd2e0, #ff99b1 40%, #ff5880);
  color: #2a0a14; box-shadow: 0 8px 0 #a2163a, 0 16px 32px rgba(255,72,120,.35);
  transition: transform .08s ease, box-shadow .08s ease, filter .2s ease;
}
.btn:hover { transform: translateY(-1px); filter: saturate(1.1); }
.btn:active { transform: translateY(2px); box-shadow: 0 4px 0 #a2163a, 0 8px 18px rgba(255,72,120,.32); }

.hint { font-size: 12px; opacity: .7 }

/* Palco */
.stage { position: absolute; inset: 0; display: grid; place-items: center; opacity: 0; pointer-events: none; }
.stage.live { opacity: 1; pointer-events: auto; transition: opacity .6s ease; }

.grid {
  width: min(1200px, 96vw); height: min(720px, 64vh);
  display: grid; grid-template-columns: repeat(10, 1fr); grid-auto-rows: 1fr; gap: clamp(6px, 1.2vw, 14px);
  transform: translateZ(0);
}

.tile { position: relative; aspect-ratio: 1 / 1; display: grid; place-items: center; }
.capy {
  width: 100%; height: 100%;
  transform-origin: 50% 80%;
  transition: transform .06s ease;
  filter: drop-shadow(0 6px 6px rgba(0,0,0,.4));
}

.pulse { animation: pulse .5s ease both; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08) translateY(-1%); } 100% { transform: scale(1); } }

/* HUD */
.hud {
  position: fixed; inset: 0; display: grid; grid-template-columns: 1fr auto; align-items: start; padding: 18px;
  pointer-events: none;
}
.hud .left { display: flex; gap: 8px; align-items: center; opacity: .9; }
.pill { pointer-events: auto; background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.18); padding: 8px 12px; border-radius: 999px; font-size: 13px; }
.kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; padding: 3px 8px; border-radius: 6px; background: rgba(255,255,255,.12); margin: 0 4px; border: 1px solid rgba(255,255,255,.25); }

/* Rodap√© */
.footer { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); opacity: .7; font-size: 12px; }
.footer a { color: #9ee7ff; text-decoration: none; }

  </style>
</head>
<body>
  <div class="gate" id="gate" aria-hidden="false">
    <div class="start" role="dialog" aria-modal="true">
      <div class="title">Capybara Konga üêæ</div>
      <div class="tag">Uma vers√£o capivara, divertida e 100% SFW do <span aria-label="site original">matias.me/nsfw</span>.</div>
      <button id="enter" class="btn">QUERO VER CAPIVARAS DAN√áANDO</button>
      <div class="hint">Dica: use fone de ouvido. Toque em qualquer lugar para iniciar o √°udio.</div>
    </div>
  </div>  <div class="stage" id="stage" aria-hidden="true">
    <div class="grid" id="grid" aria-live="polite" aria-label="Capivaras dan√ßando" ></div><div class="hud">
  <div class="left">
    <div class="pill">Barra de espa√ßo: <span class="kbd">Play/Pause</span></div>
    <div class="pill">F: <span class="kbd">Full screen</span></div>
    <div class="pill">B: <span class="kbd">BPM +/-</span></div>
    <div class="pill">S: <span class="kbd">Sem som</span></div>
    <div class="pill">Arraste um MP3 aqui para usar sua m√∫sica</div>
  </div>
</div>

<div class="footer">Feito com ‚ù§ por voc√™ ‚Ä¢ Capybara Konga ‚Ä¢ <a href="#" id="link-original" title="Abrir o site que inspirou este">inspira√ß√£o</a></div>

  </div>  <!-- SVG da capivara (s√≠mbolo reutiliz√°vel) -->  <svg width="0" height="0" style="position:absolute">
    <symbol id="capy" viewBox="0 0 120 100">
      <!-- Silhueta simples de capivara -->
      <path d="M12 58c0-22 22-38 50-38 22 0 38 10 44 24 6 15-2 29-12 35-7 4-18 6-30 6-20 0-29-8-36-12-7-4-16-6-16-15z" fill="#c9935c"/>
      <circle cx="82" cy="44" r="3.2" fill="#2b1a12"/>
      <path d="M28 66c8 6 12 10 26 10 12 0 24-3 30-8" stroke="#3a2317" stroke-width="3" stroke-linecap="round" fill="none" opacity=".25"/>
      <path d="M18 72c6 2 8 6 8 8" stroke="#3a2317" stroke-width="3" stroke-linecap="round" fill="none"/>
      <circle cx="96" cy="56" r="4.5" fill="#3a2317"/>
    </symbol>
  </svg>  <script>
    const gate = document.getElementById('gate');
    const stage = document.getElementById('stage');
    const grid = document.getElementById('grid');
    const enterBtn = document.getElementById('enter');
    const linkOriginal = document.getElementById('link-original');
    linkOriginal.addEventListener('click', (e) => { e.preventDefault(); window.open('https://matias.me/nsfw/', '_blank');});

    // ====== Constru√ß√£o da grade de capivaras ======
    const COLS = 10, ROWS = 6; // 60 capivaras
    for (let i = 0; i < COLS * ROWS; i++) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', '0 0 120 100');
      svg.classList.add('capy');
      const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');
      use.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#capy');
      svg.appendChild(use);
      tile.appendChild(svg);
      grid.appendChild(tile);
    }

    // ====== √Åudio: batida gerada via WebAudio (sem direitos autorais) ======
    let ctx, master, kickGain, hatGain, bassGain, musicBuffer, musicSource;
    let isMuted = false;

    function initAudio() {
      if (ctx) return;
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      master = ctx.createGain(); master.gain.value = 0.8; master.connect(ctx.destination);
      kickGain = ctx.createGain(); kickGain.gain.value = 0.9; kickGain.connect(master);
      hatGain = ctx.createGain(); hatGain.gain.value = 0.25; hatGain.connect(master);
      bassGain = ctx.createGain(); bassGain.gain.value = 0.22; bassGain.connect(master);
    }

    function playKick(time) {
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine'; o.frequency.setValueAtTime(150, time);
      o.frequency.exponentialRampToValueAtTime(40, time + 0.18);
      g.gain.setValueAtTime(1, time); g.gain.exponentialRampToValueAtTime(0.001, time + 0.2);
      o.connect(g).connect(kickGain);
      o.start(time); o.stop(time + 0.22);
    }

    function playHat(time) {
      // Ru√≠do branco filtrado
      const bufferSize = 2 * ctx.sampleRate;
      const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const data = noiseBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
      const noise = ctx.createBufferSource(); noise.buffer = noiseBuffer;
      const bandpass = ctx.createBiquadFilter(); bandpass.type = 'bandpass'; bandpass.frequency.value = 8000;
      const g = ctx.createGain(); g.gain.setValueAtTime(0.6, time); g.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
      noise.connect(bandpass).connect(g).connect(hatGain);
      noise.start(time); noise.stop(time + 0.06);
    }

    function playBass(time, note = 60) {
      const o = ctx.createOscillator(); o.type = 'sawtooth';
      const g = ctx.createGain(); g.gain.value = 0.0;
      o.frequency.value = note; // Hz
      const f = ctx.createBiquadFilter(); f.type = 'lowpass'; f.frequency.value = 400;
      o.connect(f).connect(g).connect(bassGain);
      g.gain.setValueAtTime(0.0, time);
      g.gain.linearRampToValueAtTime(0.25, time + 0.02);
      g.gain.exponentialRampToValueAtTime(0.01, time + 0.3);
      o.start(time); o.stop(time + 0.32);
    }

    // Reproduzir m√∫sica customizada (arraste um mp3)
    async function playMusicBuffer(startAt) {
      if (!musicBuffer) return;
      stopMusic();
      musicSource = ctx.createBufferSource();
      musicSource.buffer = musicBuffer;
      musicSource.connect(master);
      musicSource.start(startAt);
    }
    function stopMusic() {
      try { musicSource && musicSource.stop(); } catch (e) {}
      musicSource = null;
    }

    // ====== Sequenciador ======
    let playing = false;
    let bpm = 120; // alter√°vel com B
    let nextNoteTime = 0;
    let current16th = 0;
    const lookahead = 25.0; // ms
    const scheduleAheadTime = 0.1; // s

    function nextNote() {
      const secondsPerBeat = 60.0 / bpm;
      nextNoteTime += 0.25 * secondsPerBeat; // 16ths
      current16th = (current16th + 1) % 16;
    }

    function scheduleNote(beatNumber, time) {
      // visual
      const tiles = document.querySelectorAll('.tile');
      const hitRow = beatNumber % ROWS;
      for (let c = 0; c < COLS; c++) {
        const idx = hitRow * COLS + c;
        const el = tiles[idx]?.firstChild;
        if (el) {
          el.classList.remove('pulse');
          // reflow to restart animation
          void el.offsetWidth;
          el.classList.add('pulse');
        }
      }

      // √°udio
      if (!isMuted && ctx) {
        if (beatNumber % 4 === 0) playKick(time);
        if (beatNumber % 2 === 0) playHat(time);
        if (beatNumber % 4 === 2) playBass(time, 55 + (Math.random() * 4));
      }
    }

    let timerID;
    function scheduler() {
      while (nextNoteTime < ctx.currentTime + scheduleAheadTime) {
        scheduleNote(current16th, nextNoteTime);
        nextNote();
      }
      timerID = setTimeout(scheduler, lookahead);
    }

    function start() {
      initAudio();
      if (ctx.state === 'suspended') ctx.resume();
      playing = true;
      nextNoteTime = ctx.currentTime + 0.05;
      current16th = 0;
      scheduler();
    }

    function stop() {
      playing = false;
      clearTimeout(timerID);
      stopMusic();
    }

    // ====== Intera√ß√µes ======
    async function goFullScreen() {
      const el = document.documentElement;
      if (document.fullscreenElement) return;
      try { await (el.requestFullscreen?.call(el) || el.webkitRequestFullscreen?.call(el)); } catch (e) {}
    }

    function toggle() { if (playing) { stop(); } else { start(); } }

    function enter() {
      gate.setAttribute('aria-hidden', 'true');
      stage.setAttribute('aria-hidden', 'false');
      stage.classList.add('live');
      goFullScreen();
      start();
    }

    enterBtn.addEventListener('click', enter);
    document.addEventListener('click', () => { if (!ctx) initAudio(); }, { once: true });

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); toggle(); }
      if (e.key.toLowerCase() === 'f') { goFullScreen(); }
      if (e.key.toLowerCase() === 'b') { bpm = (bpm >= 180 ? 90 : bpm + 10); }
      if (e.key.toLowerCase() === 's') { isMuted = !isMuted; }
    });

    // Arrastar e soltar arquivo de √°udio
    window.addEventListener('dragover', (e) => { e.preventDefault(); });
    window.addEventListener('drop', async (e) => {
      e.preventDefault();
      if (!e.dataTransfer.files?.length) return;
      const file = e.dataTransfer.files[0];
      if (!/audio\/(mp3|mpeg|wav|ogg)/.test(file.type)) return alert('Solte um arquivo de √°udio (mp3/wav/ogg).');
      initAudio();
      const arrayBuf = await file.arrayBuffer();
      musicBuffer = await ctx.decodeAudioData(arrayBuf);
      playMusicBuffer(ctx.currentTime + 0.1);
    });
  </script></body>
</html>